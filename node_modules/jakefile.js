/*global desc, task, jake, fail, complete, require, console, lint*/

(function () {
    "use strict";
    // this function is strict...



task("default", ["lint", "test"]);

desc("Lint everything");


task("lint", [], function () {

    //console.log("Lint code goes here");
    var lint = require("../build/lint/lint_runner.js");
   // lint.validateFile("Jakefile.js",{},{});
    //
    var files = new jake.FileList();
    files.exclude("node_modules");
    files.exclude("../build");
    files.include("../**/*.js");



    function nodeLintOptions() {
        var options = {
            bitwise: true,
            curly: false,
            eqeqeq: true,
            forin: true,
            immed: true,
            latedef: true,
            newcap: true,
            noarg: true,
            noempty: true,
            nonew: true,
            regexp: true,
            undef: true,
            strict: true,
            trailing: true,
            node: true
        };
        return options;
    }
    //
    var options = nodeLintOptions();

    lint.validateFileList(files.toArray(), options, {} || fail("Lint failed!"));
    // lint.validateFile("jakefile.js", {}, {});
});

    desc("Test everything");

    task("test", [], function () {
        //console.log("test goes here");
        var reporter = require('nodeunit').reporters.default;
        reporter.run(['../src/server/_server_test.js'], null, function (failures) {
            if (failures){

                fail("Tests failed!");
            }
            complete();
        });
    }, {async: true});

desc("integrate");
task("integrate", ["default"], function () {
    console.log("1. Make sure 'git status' is clean");
    console.log("2. Build on the integration box");
    console.log("  a. Walk over to integration box");
    console.log("  b. 'git pull'");
    console.log("  c. 'jake'");
    console.log("  d. If jake fails stop!, star over!");
    console.log("3. 'git checkout integration'");
    console.log("4. 'git merge master --no-ff --log'");
    console.log("5. 'git checkout master'");
});





/*
	desc("Example!");

task("example",["dependency"], function () {
	console.log("example task");
});

task("dependency", function () {
	console.log("dependency:notepad");
});*/

}());